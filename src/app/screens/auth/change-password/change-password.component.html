<div class="change-password-page">
    <div class="change-password-container">

        <div class="form-section">
            <div class="form-header">
                <img src="assets/images/diplogo.png" alt="Brand Logo" class="logo" />
                <h2>Change Password</h2>
                <p>Update your password to keep your account secure</p>
            </div>

            <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
                <div class="form-group">
                    <label>Email Address</label>
                    <div class="input-icon">
                        <i class="bi bi-envelope"></i>
                        <input type="email" formControlName="emailId" placeholder="email@example.com" readonly
                            style="background-color: #ececec" />
                    </div>
                    <small *ngIf="isFieldRequired('emailId')" class="error">Email is required.</small>
                    <small *ngIf="(changePasswordForm.controls['emailId'].hasError('email') && changePasswordForm.controls['emailId'].touched) || 
      changePasswordForm.controls['emailId'].hasError('pattern') && changePasswordForm.controls['emailId'].touched"
                        class="error">Enter a valid email address.</small>
                </div>

                <div class="form-group">
                    <label>Current Password</label>
                    <div class="input-icon">
                        <i class="bi bi-lock"></i>
                        <input [type]="showOldPassword ? 'text' : 'password'" formControlName="oldPassword"
                            placeholder="Enter current password" />
                        <img src="assets/images/icons/viewPassword.svg" alt="Toggle Password" class="password-toggle"
                            (click)="showOldPassword = !showOldPassword" />
                    </div>
                    <small *ngIf="isFieldRequired('oldPassword')" class="error">Current password is required.</small>
                </div>

                <div class="form-group">
                    <label>New Password</label>
                    <div class="input-icon">
                        <i class="bi bi-lock"></i>
                        <input [type]="showNewPassword ? 'text' : 'password'" formControlName="newPassword"
                            placeholder="Enter new password" />
                        <img src="assets/images/icons/viewPassword.svg" alt="Toggle Password" class="password-toggle"
                            (click)="showNewPassword = !showNewPassword" />
                    </div>
                    <small *ngIf="isFieldRequired('newPassword')" class="error">New password is required.</small>
                    <small
                        *ngIf="changePasswordForm.controls['newPassword'].hasError('minLength') && changePasswordForm.controls['newPassword'].touched"
                        class="error">Password must be at least 6 characters.</small>
                    <small *ngIf="changePasswordForm.controls['newPassword'].hasError('invalidCombination') &&
         (changePasswordForm.controls['newPassword'].touched || changePasswordForm.controls['newPassword'].dirty)"
                        class="error">Password should include a special character, uppercase letter, and number.</small>
                </div>

                <button type="submit" class="submit-btn" [disabled]="!changePasswordForm.valid">Update Password</button>
                <p class="redirect">Return to login? <a href="/auth/login">Back to Login</a></p>
            </form>
        </div>

        <div class="preview-section">
            <div class="image-carousel">
                <img *ngFor="let img of carouselImages; let i = index" [src]="img"
                    [class.active]="i === currentImageIndex" alt="Preview Image" />
            </div>

            <div class="carousel-dots">
                <span *ngFor="let img of carouselImages; let i = index" [class.active]="i === currentImageIndex"
                    class="dot" (click)="currentImageIndex = i"></span>
            </div>

            <div class="caption">
                <h3>Secure your workspace.</h3>
                <p>Keep your account protected with a strong password.</p>
            </div>
        </div>
    </div>

    <div class="spinner" *ngIf="loadSpinner">Loading...</div>
</div>